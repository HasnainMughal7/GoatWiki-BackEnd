"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.loadPageCode = void 0;
const utils_1 = require("../utils");
async function loadPageCode(pageConfig, isDev) {
    const configValues = {};
    // In dev, Vite already caches the page's virtual module
    if (!isDev && 'configValues' in pageConfig) {
        return pageConfig;
    }
    const codeFiles = await pageConfig.loadCodeFiles();
    codeFiles.forEach(({ configName, codeFilePath3, codeFileExports }) => {
        (0, utils_1.assertDefaultExport)(codeFileExports, codeFilePath3);
        (0, utils_1.assert)(!(configName in configValues));
        configValues[configName] = codeFileExports.default;
    });
    Object.entries(pageConfig.configSources).map(([configName, configSource]) => {
        if (configSource.codeFilePath2)
            return;
        (0, utils_1.assert)(!(configName in configValues));
        configValues[configName] = configSource.configValue;
    });
    (0, utils_1.objectAssign)(pageConfig, { configValues });
    return pageConfig;
}
exports.loadPageCode = loadPageCode;
