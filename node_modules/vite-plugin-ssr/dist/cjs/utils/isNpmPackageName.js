"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getNpmPackageName = exports.isNpmPackageModule = exports.isNpmPackageName = void 0;
const assert_1 = require("./assert");
const invalidNameRE = /[^a-zA-Z-_]/;
function isNpmPackageName(str) {
    const res = parseNpmPath(str);
    return res !== null && res.modulePath === null;
}
exports.isNpmPackageName = isNpmPackageName;
function isNpmPackageModule(str) {
    const res = parseNpmPath(str);
    return res !== null;
}
exports.isNpmPackageModule = isNpmPackageModule;
function getNpmPackageName(str) {
    const res = parseNpmPath(str);
    if (!res)
        return null;
    return res.npmPackageName;
}
exports.getNpmPackageName = getNpmPackageName;
function parseNpmPath(str) {
    if (str === undefined || str.includes('\\') || str.startsWith('/')) {
        return null;
    }
    let scope = null;
    if (str.startsWith('@')) {
        if (!str.includes('/')) {
            return null;
        }
        const [first, ...rest] = str.split('/');
        scope = first;
        str = rest.join('/');
        (0, assert_1.assert)(scope && scope.startsWith('@'));
    }
    if (str === '') {
        return null;
    }
    const [first, ...rest] = str.split('/');
    const name = first;
    const path = rest.length === 0 ? null : rest.join('/');
    (0, assert_1.assert)(name);
    if (invalidNameRE.test(name) || (scope && invalidNameRE.test(scope.slice(1)))) {
        return null;
    }
    const npmPackageName = scope ? `${scope}/${name}` : name;
    return {
        npmPackageName,
        modulePath: path
    };
}
