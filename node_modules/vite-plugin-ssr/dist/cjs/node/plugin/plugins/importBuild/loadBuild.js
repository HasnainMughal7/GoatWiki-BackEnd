"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.setLoaders = exports.loadBuild = void 0;
const loadServerBuild_1 = require("@brillout/vite-plugin-import-build/loadServerBuild");
// We import from node/utils.ts insead of node/plugin/utils.ts because this file is loaded by the server runtime
const utils_1 = require("../../../../node/utils");
const buildGetters = (globalThis.__vite_plugin_ssr__buildGetters = globalThis.__vite_plugin_ssr__buildGetters || {
    getters: null
});
function setLoaders(getters) {
    buildGetters.getters = getters;
}
exports.setLoaders = setLoaders;
async function loadBuild() {
    if (!buildGetters.getters) {
        await (0, loadServerBuild_1.loadServerBuild)();
        (0, utils_1.assert)(buildGetters.getters);
    }
    const [pageFiles, clientManifest, pluginManifest] = await Promise.all([
        buildGetters.getters.pageFiles(),
        buildGetters.getters.clientManifest(),
        buildGetters.getters.pluginManifest()
    ]);
    const buildEntries = { pageFiles, clientManifest, pluginManifest };
    return buildEntries;
}
exports.loadBuild = loadBuild;
